(function(a){var c=Math.min,d=Math.abs;"undefined"==typeof a.Lowlight&&(a.Lowlight={}),"object"==typeof module&&"object"==typeof module.exports&&(module.exports=a.Lowlight);class b{constructor(){this.nodes=new Map}id(a){return a}node(a,b=!1){return b?this.nodes.get(this.id(arguments[0])):this.nodes.get(a)}data(a){return a.graph.get(this)._data}adjacent(c,a){return c.graph.get(this).has(a)}neighbors(a){return Array.from(a.graph.get(this).keys())}connected(c,a){return c.graph.get(this)._connectivity===a.graph.get(this)._connectivity}connect(a,b){0===arguments.length?this.nodes.forEach((a,b)=>{setTimeout(()=>{this.connect(a,b)},0)}):a.graph.get(this)._connectivity===void 0&&(a.graph.get(this)._connectivity=b,this.neighbors(a).map((a)=>{setTimeout(()=>{this.connect(a,b)},0)}))}add(a){return 1<arguments.length?Array.from(arguments).map((a)=>this.add(a)):(a.graph.set(this,new Map),this.nodes.set(a.id,a),a)}delete(a){return 1<arguments.length?Array.from(arguments).map((a)=>this.delete(a)):(a.graph.delete(this),this.nodes.delete(a.id),a)}edge(c,a,b=1,d=1){if(!c.graph.has(this)||!a.graph.has(this))throw new Error("Nodes must be on the same graph");return null===b?c.graph.get(this).delete(a):c.graph.get(this).set(a,b),null===d?a.graph.get(this).delete(c):a.graph.get(this).set(c,d),this}cost(c,a){return this.adjacent(c,a)?c.graph.get(this).get(a):null}}b.fromArray=function(a,c={}){let d=b.fromArray.X(a,c.order),f=b.fromArray.Y(a,c.order),g=b.fromArray.at.bind(null,a,c.order),h=[],j=null;for(let k,l=1;l<Math.max(2,arguments.length);l++){k=new b,h.push(k),c=arguments[l]||{};let a=b.fromArray.id.bind(null,d,f,c.torus),i=c.cost||b.fromArray.cost,n=b.fromArray.edge.bind(null,k,i);for(let b=0;b<d;b++)for(let c,d=0;d<f;d++)c=k.add(j?j.get(a(b,d)):new e(a(b,d))),c.x=b,c.y=d,c.graph.get(k)._data=g(b,d),n(c,k.nodes.get(a(b-1,d))),n(c,k.nodes.get(a(b+1,d))),n(c,k.nodes.get(a(b,d-1))),n(c,k.nodes.get(a(b,d+1)));if(c.diagonals)for(let b=0;b<d;b++)for(let d=0;d<f;d++){let e=k.nodes.get(a(b,d)),f=k.adjacent(e,k.nodes.get(a(b-1,d))),g=k.adjacent(e,k.nodes.get(a(b+1,d))),h=k.adjacent(e,k.nodes.get(a(b,d-1))),i=k.adjacent(e,k.nodes.get(a(b,d+1)));(f||h||c.cutting)&&n(e,k.nodes.get(a(b-1,d-1))),(f||i||c.cutting)&&n(e,k.nodes.get(a(b-1,d+1))),(g||h||c.cutting)&&n(e,k.nodes.get(a(b+1,d-1))),(g||i||c.cutting)&&n(e,k.nodes.get(a(b+1,d+1)))}Object.defineProperty(k,"id",{enumerable:!1,configurable:!1,writable:!0,value(b){return a(b.x,b.y)}}),k.connect(),j||(j=k.nodes)}return 1<h.length?h:h[0]},b.fromArray.X=function(a,b="yx"){return"xy"===b?a.length:"yx"===b?a[0].length:0},b.fromArray.Y=function(a,b="yx"){return"xy"===b?a[0].length:"yx"===b?a.length:0},b.fromArray.at=function(a,b="yx",c,d){return"xy"===b?a[c][d]:a[d][c]},b.fromArray.id=function(a=0,b=0,c=!1,d,e){return c?(e+b)%b*a+(d+a)%a:0<=d&&d<a&&0<=e&&e<b?e*a+d:null},b.fromArray.cost=function(){return 1},b.fromArray.edge=function(c,d,e,a){a&&c.edge(e,a,d(c.data(e),c.data(a)),d(c.data(a),c.data(e)))};class e{constructor(a,b){for(let c in this.id=a,this.graph=new Map,b)"id"!=c&&"graph"!=c&&(this[c]=b[c])}}class f{constructor(a){this.nodes=[],this.score="function"==typeof a?a:(b)=>{return+b}}get size(){return this.nodes.length}add(a){if(1<arguments.length){for(let a=0;a<arguments.length;a++)this.add(arguments[a]);return this}return this.nodes.push(a),this.bubble(this.size-1)}set(a){let b=this.nodes.indexOf(a);return~b?this.score(a)<=this.score(this.nodes[b])?this.bubble(this.nodes.indexOf(a)):this.sink(this.nodes.indexOf(a)):this.add(a)}pop(){let a=this.nodes[0],b=this.nodes.pop();return 0<this.size&&(this.nodes[0]=b,this.sink(0)),a}top(){return this.nodes[0]}delete(a){if(1<arguments.length){for(let a=0;a<arguments.length;a++)this.delete(arguments[a]);return this}for(let b=0;b<this.size;b++){if(this.nodes[b]!=a)continue;let c=this.nodes.pop();return b==this.size-1?this:(this.nodes[b]=c,this.bubble(b).sink(b))}}bubble(a){let b=this.nodes[a],c=this.score(b);for(;0<a;){let d=Math.floor((a+1)/2)-1,e=this.nodes[d];if(c>=this.score(e))break;this.nodes[d]=b,this.nodes[a]=e,a=d}return this}sink(a){let b=this.nodes[a],c=this.score(b);for(;;){let d=2*(a+1),e=d-1,f=null;if(e<this.size&&this.score(this.nodes[e])<c&&(f=e),d<this.size&&this.score(this.nodes[d])<(f?this.score(this.nodes[f]):c)&&(f=d),null===f)break;this.nodes[a]=this.nodes[f],this.nodes[f]=b,a=f}return this}}let g={manhattan:function(c,a,b={}){let e=d(a.x-c.x),f=d(a.y-c.y);return(b.multiplier||1)*(e+f)},manhattanTorus:function(e,a,b={}){let f=c(d(a.x-e.x),a.x+(b.x||0)-e.x,e.x+(b.x||0)-a.x),g=c(d(a.y-e.y),a.y+(b.y||0)-e.y,e.y+(b.y||0)-a.y);return(b.multiplier||1)*(f+g)},diagonal:function(e,a,b={}){let f=d(a.x-e.x),g=d(a.y-e.y);return m*(f+g)+(dm-2*m)*c(f,g)},diagonalTorus:function(e,a,b={}){let f=c(d(a.x-e.x),a.x+(b.x||0)-e.x,e.x+(b.x||0)-a.x),g=c(d(a.y-e.y),a.y+(b.y||0)-e.y,e.y+(b.y||0)-a.y);return(b.multiplier||1)*(f+g)+((b.diagonalMultiplier||1.4)-2*(b.multiplier||1))*c(f,g)},euclidian:function(c,a,b={}){let e=d(a.x-c.x),f=d(a.y-c.y);return(b.multiplier||1)*Math.sqrt(e*e+f*f)},euclidianTorus:function(e,a,b={}){let f=c(d(a.x-e.x),a.x+(b.x||0)-e.x,e.x+(b.x||0)-a.x),g=c(d(a.y-e.y),a.y+(b.y||0)-e.y,e.y+(b.y||0)-a.y);return(b.multiplier||1)*(f+g)+((b.diagonalMultiplier||1.4)-2*(b.multiplier||1))*c(f,g)}};class h extends Error{constructor(a){super(a),this.name="WorkerError"}}class i{constructor(a,c={}){if(this.graphs=[],this.heuristic=c.heuristic||"manhattan",this.heuristicOptions=c.heuristicOptions||{},Array.isArray(a)&&(this.heuristic=c.heuristic in g?c.heuristic:c.diagonals?c.torus?"diagonalTorus":"diagonal":c.torus?"manhattanTorus":"manhattan",this.heuristicOptions.x=b.fromArray.X(a,c.order),this.heuristicOptions.y=b.fromArray.Y(a,c.order),this.graphs=b.fromArray.apply(this,arguments),!Array.isArray(this.graphs)&&(this.graphs=[this.graphs])),c.thread&&("undefined"==typeof WorkerGlobalScope||!(self instanceof WorkerGlobalScope))){this.worker=null;try{this.worker=new Worker(c.thread)}catch(a){throw"file:"===window.location.protocol&&console.warn("WebWorkers in local files may not be supported by your browser."),new h(`${c.thread} couldn't be opened.`)}"cost"in c&&(c.cost=c.cost.toString()),this.worker.postMessage(["constructor",a,c]),this.path=(a,b,c={})=>{this._worker_path_callback=c.callback,delete c.callback,this.worker.postMessage(["path",a,b,c])},this.worker.onmessage=(a)=>{let b=JSON.parse(a.data);switch(b[0]){case"path":this._worker_path_callback(b[1]);}}}}path(a,b,c={}){let d=new f((a)=>{return a.estimated}),e=new Map,h=this.graphs[c.layer||0];if(a=h.node(a,!0),b=h.node(b,!0),d.add({node:a,estimated:0}),e.set(a,{score:0,from:null}),h.connected(a,b))for(;d.size;){let a=d.pop().node;if(a===b)break;h.neighbors(a).map((f)=>{let i=(e.has(a)?e.get(a).score:0)+h.cost(a,f);i<(e.has(f)?e.get(f).score:Infinity)&&(e.set(f,{score:i,from:a}),d.set({node:f,estimated:i+g[c.heuristic||this.heuristic](f,b,c.heuristicOptions||this.heuristicOptions)}))}),d.delete(a)}let i=[];if(e.has(b)){let a=b;for(i.push(b);null!==(a=e.get(a).from);)i.push(a);i=i.reverse()}return c.callback&&c.callback(i,e),i}}if("undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope){let a;onmessage=function(b){let c=b.data;switch(c[0]){case"constructor":if("cost"in c[2]){let a=/^\((.*?)\)\s*=>\s*{/.test(c[2].cost),b=/^function /.test(c[2].cost);c[2].cost=eval(`(${a||b?"":"function "}${c[2].cost})`)}a=new i(c[1],c[2]);break;case"path":postMessage(JSON.stringify(["path",a.path(c[1],c[2],c[3])]));}}}a.Lowlight.Astar={Graph:b,Node:e,BinaryHeap:f,Heuristic:g,Configuration:i,WorkerError:h}})("undefined"==typeof window?this:window);
